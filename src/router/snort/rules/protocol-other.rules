# Copyright 2001-2023 Sourcefire, Inc. All Rights Reserved.
#
# This file contains (i) proprietary rules that were created, tested and certified by
# Sourcefire, Inc. (the "VRT Certified Rules") that are distributed under the VRT
# Certified Rules License Agreement (v 2.0), and (ii) rules that were created by
# Sourcefire and other third parties (the "GPL Rules") that are distributed under the
# GNU General Public License (GPL), v2.
# 
# The VRT Certified Rules are owned by Sourcefire, Inc. The GPL Rules were created
# by Sourcefire and other third parties. The GPL Rules created by Sourcefire are
# owned by Sourcefire, Inc., and the GPL Rules not created by Sourcefire are owned by
# their respective creators. Please see http://www.snort.org/snort/snort-team/ for a
# list of third party owners and their respective copyrights.
# 
# In order to determine what rules are VRT Certified Rules or GPL Rules, please refer
# to the VRT Certified Rules License Agreement (v2.0).
#
#----------------------
# PROTOCOL-OTHER RULES
#----------------------

# alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"PROTOCOL-OTHER Cesanta Mongoose MQTT integer overflow attempt"; flow:to_server,established; flowbits:isset,MQTT_Connect; byte_test:4,>=,0x80808080,1; byte_test:1,=,0x01,5,bitmask 0x08; metadata:policy max-detect-ips drop, policy security-ips drop; reference:cve,2019-19307; reference:url,github.com/cesanta/mongoose/releases/tag/6.17; classtype:attempted-dos; sid:53214; rev:2;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"PROTOCOL-OTHER MQTT Connect control packet detected"; flow:to_server,established; content:"|10|"; depth:1; content:"|00 04|MQTT|04|"; within:7; distance:1; flowbits:set,MQTT_Connect; flowbits:noalert; metadata:policy max-detect-ips alert, policy security-ips alert; reference:url,docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718009; classtype:misc-activity; sid:53213; rev:3;)
# alert udp $EXTERNAL_NET any -> $HOME_NET 8211 (msg:"PROTOCOL-OTHER Aruba Mobility Controller PAPI memory corruption attempt"; flow:to_server; content:"|49 72 00 01|"; depth:4; content:"|20 D9|"; within:2; distance:12; content:"|36 B1|"; within:2; distance:8; content:"|00 FF FF 90|"; within:4; distance:16; metadata:policy max-detect-ips drop, policy security-ips drop; reference:cve,2018-7081; reference:url,www.arubanetworks.com/assets/alert/ARUBA-PSA-2019-004.txt; classtype:attempted-admin; sid:52505; rev:2;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 6666:7000 (msg:"PROTOCOL-OTHER Colloquy INVITE request format string DoS attempt"; flow:to_server,established; content:"INVITE|20|"; content:"%n%n%n%n"; distance:0; fast_pattern; pcre:"/INVITE\x20[^\r\n]+%n%n%n%n/"; metadata:policy max-detect-ips drop, service irc; reference:cve,2007-0344; reference:url,jon.oberheide.org/moab/MOAB-16-01-2007.html; classtype:attempted-user; sid:51297; rev:1;)
# alert tcp $EXTERNAL_NET 6666:7000 -> $HOME_NET any (msg:"PROTOCOL-OTHER Colloquy INVITE request format string DoS attempt"; flow:to_client,established; content:"INVITE|20|"; content:"%n%n%n%n"; distance:0; fast_pattern; pcre:"/INVITE\x20[^\r\n]+%n%n%n%n/"; metadata:policy max-detect-ips drop, service irc; reference:cve,2007-0344; reference:url,jon.oberheide.org/moab/MOAB-16-01-2007.html; classtype:attempted-user; sid:51296; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"PROTOCOL-OTHER Eclipse MQTT Message Broker Topic denial of service attempt"; flow:to_server,established; content:"|30|"; depth:1; byte_extract:1,2,length,relative; content:"$"; within:length; content:!"SYS"; within:3; metadata:policy max-detect-ips drop; reference:cve,2017-7650; classtype:denial-of-service; sid:51104; rev:1;)
# alert tcp $EXTERNAL_NET [1883,8883] -> $HOME_NET any (msg:"PROTOCOL-OTHER Losant Arduino MQTT Client buffer overflow attempt"; flow:to_client,established; content:"|30|"; depth:1; byte_test:1,>,0x7F,0,relative; byte_test:1,>,0x7F,1,relative; byte_test:1,>,0x7F,2,relative; byte_test:1,>,0x7F,3,relative; metadata:policy max-detect-ips drop; reference:cve,2018-17614; reference:url,github.com/knolleary/pubsubclient/releases/tag/v2.7; classtype:attempted-user; sid:51017; rev:2;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"PROTOCOL-OTHER MQTT Client ID ACL Bypass attempt"; flow:to_server,established; content:"|10|"; depth:1; byte_extract:1,0,length,relative; content:"/"; within:length; metadata:policy max-detect-ips drop; reference:cve,2017-7650; classtype:attempted-admin; sid:50933; rev:2;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"PROTOCOL-OTHER MQTT Client ID ACL Bypass attempt"; flow:to_server,established; content:"|10|"; depth:1; byte_extract:1,0,length,relative; content:"+"; within:length; metadata:policy max-detect-ips drop; reference:cve,2017-7650; classtype:attempted-admin; sid:50932; rev:2;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"PROTOCOL-OTHER MQTT Client ID ACL Bypass attempt"; flow:to_server,established; content:"|10|"; depth:1; byte_extract:1,0,length,relative; content:"#"; within:length; metadata:policy max-detect-ips drop; reference:cve,2017-7650; classtype:attempted-admin; sid:50931; rev:2;)
# alert udp $EXTERNAL_NET 389 -> $HOME_NET any (msg:"PROTOCOL-OTHER CLDAP potential reflected distributed denial of service attempt"; flow:to_server; content:"|30 84 00 00 00|"; depth:5; dsize:>2000; metadata:policy max-detect-ips drop; reference:url,www.akamai.com/us/en/multimedia/documents/state-of-the-internet/cldap-threat-advisory.pdf; classtype:attempted-dos; sid:46374; rev:2;)
# alert udp $EXTERNAL_NET any -> $HOME_NET 389 (msg:"PROTOCOL-OTHER CLDAP potential reflected distributed denial of service attempt"; flow:to_server; content:"|30 84 00 00 00|"; depth:5; detection_filter:track by_src, count 5, seconds 60; metadata:policy max-detect-ips drop; reference:url,www.akamai.com/us/en/multimedia/documents/state-of-the-internet/cldap-threat-advisory.pdf; classtype:attempted-dos; sid:46373; rev:2;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 32764 (msg:"PROTOCOL-OTHER use of undocumented ScMM test interface in Cisco small business devices detected"; flow:to_server,established; isdataat:6; content:"ScMM"; depth:4; metadata:policy max-detect-ips drop, ruleset community; reference:cve,2014-0659; classtype:misc-activity; sid:46124; rev:3;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 32764 (msg:"PROTOCOL-OTHER use of undocumented ScMM test interface in Cisco small business devices detected"; flow:to_server,established; isdataat:6; content:"MMcS"; depth:4; metadata:policy max-detect-ips drop, ruleset community; reference:cve,2014-0659; classtype:misc-activity; sid:46123; rev:3;)
# alert tcp $EXTERNAL_NET 32764 -> $HOME_NET any (msg:"PROTOCOL-OTHER use of undocumented ScMM test interface in Cisco small business devices detected"; flow:to_client,established; isdataat:6; content:"ScMM"; depth:4; metadata:policy max-detect-ips drop, ruleset community; reference:cve,2014-0659; classtype:misc-activity; sid:46122; rev:3;)
# alert tcp $EXTERNAL_NET 32764 -> $HOME_NET any (msg:"PROTOCOL-OTHER use of undocumented ScMM test interface in Cisco small business devices detected"; flow:to_client,established; isdataat:6; content:"MMcS"; depth:4; metadata:policy max-detect-ips drop, ruleset community; reference:cve,2014-0659; classtype:misc-activity; sid:46121; rev:3;)
# alert udp $EXTERNAL_NET any -> $HOME_NET 520 (msg:"PROTOCOL-OTHER Routing Information Protocol version 1 potential amplified distributed denial of service attempt"; flow:to_server; content:"|01 01 00 00 00|"; depth:5; fast_pattern; content:"|00 00|"; within:2; distance:1; detection_filter:track by_src, count 50, seconds 1; metadata:policy max-detect-ips drop; reference:url,blogs.akamai.com/2015/07/ripv1-reflection-ddos-making-a-comeback.html; classtype:attempted-dos; sid:46098; rev:2;)
# alert ip $EXTERNAL_NET any -> $HOME_NET any (msg:"PROTOCOL-OTHER STCP heartbeat chunk denial of service attempt"; ip_proto:132; content:"|04 00|"; byte_jump:2,0,relative,post_offset -4; content:"|04 00|"; within:2; byte_jump:2,0,relative,post_offset -4; content:"|04 00|"; within:2; byte_jump:2,0,relative,post_offset -4; content:"|04 00|"; within:2; metadata:policy max-detect-ips drop; reference:url,ietf.org/rfc/rfc5062.txt; classtype:denial-of-service; sid:44015; rev:2;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET [445,139] (msg:"PROTOCOL-OTHER NETBIOS Session Service header length field denial of service attempt"; flow:to_server,established,no_stream; isdataat:3; isdataat:!4; content:"|00 01|"; depth:2; byte_test:2,>=,0x2710, 0, relative; detection_filter:track by_src, count 25, seconds 1; metadata:policy max-detect-ips drop, service netbios-ssn; reference:url,smbloris.com/; classtype:attempted-dos; sid:43928; rev:4;)
alert tcp any any -> $HOME_NET 445 (msg:"PROTOCOL-OTHER NETBIOS SMB IPC share access attempt"; flow:to_server,established; content:"|FF|SMB|75 00 00 00 00|"; depth:9; offset:4; content:"I|00|P|00|C|00|$|00 00 00|"; fast_pattern:only; flowbits:set,smb.tree.connect.ipc; flowbits:noalert; metadata:policy balanced-ips alert, policy max-detect-ips alert, policy security-ips alert, ruleset community, service netbios-ssn; reference:url,attack.mitre.org/techniques/T1077; classtype:misc-activity; sid:43003; rev:8;)
alert tcp any any -> $HOME_NET 445 (msg:"PROTOCOL-OTHER NETBIOS SMB IPC share access attempt"; flow:to_server,established; content:"|FF|SMB|75 00 00 00 00|"; depth:9; offset:4; content:"IPC$|00|"; fast_pattern:only; flowbits:set,smb.tree.connect.ipc; flowbits:noalert; metadata:policy balanced-ips alert, policy max-detect-ips alert, policy security-ips alert, ruleset community, service netbios-ssn; reference:url,attack.mitre.org/techniques/T1077; classtype:misc-activity; sid:43002; rev:8;)
# alert tcp $EXTERNAL_NET 3389 -> $HOME_NET any (msg:"PROTOCOL-OTHER FreeRDP invalid MCS serverRandomLen out of bounds read attempt"; flow:to_client,established; content:"|03 00|"; content:"|02 F0 80 7F 66|"; within:5; distance:2; content:"|03 0C 08 00 EB 03 00 00 02 0C|"; byte_test:4,>,0x7FFFFFFF,10,relative,little; metadata:policy max-detect-ips drop, policy security-ips drop, service rdp; reference:cve,2017-2837; reference:url,www.talosintelligence.com/reports/TALOS-2017-0339/; classtype:attempted-user; sid:42998; rev:3;)
# alert tcp $EXTERNAL_NET 3389 -> $HOME_NET any (msg:"PROTOCOL-OTHER FreeRDP invalid EncryptedPlatformChallenge null pointer dereference attempt"; flow:to_client,established; content:"|03 00|"; byte_extract:2,0,pktlen,relative; content:"|02 F0 80 68 00 01 03 EB 70|"; within:9; content:"|80 00|"; within:2; distance:2; content:"|02|"; within:1; distance:2; byte_test:2,>,pktlen,9,relative,little; metadata:policy max-detect-ips drop, policy security-ips drop, service rdp; reference:cve,2017-2839; reference:url,www.talosintelligence.com/reports/TALOS-2017-0341/; classtype:attempted-user; sid:42975; rev:3;)
# alert tcp $EXTERNAL_NET 3389 -> $HOME_NET any (msg:"PROTOCOL-OTHER FreeRDP invalid cbCompanyName out of bounds read attempt"; flow:to_client,established; content:"|03 00|"; depth:2; content:"|02 F0 80 68 00 01 03 EB 70|"; within:9; distance:2; content:"|80 00|"; within:2; distance:2; content:"|01|"; within:1; distance:2; byte_test:4,>,0xFFFFFFFB,39,relative,little; metadata:policy max-detect-ips drop, policy security-ips drop, service rdp; reference:cve,2017-2838; reference:url,www.talosintelligence.com/reports/TALOS-2017-0340/; classtype:attempted-user; sid:42974; rev:3;)
# alert tcp $EXTERNAL_NET 3389 -> $HOME_NET any (msg:"PROTOCOL-OTHER FreeRDP RSA modulus length integer underflow attempt"; flow:to_client,established; content:"|03 00|"; depth:2; content:"|02 F0 80 68 00 01 03 EB 70|"; within:9; distance:2; content:"|01 00 00 00 01 00 00 00 06 00|"; content:"RSA1"; within:4; distance:2; byte_test:4,<,8,0,relative,little; metadata:policy max-detect-ips drop, policy security-ips drop, service rdp; reference:cve,2017-2836; reference:url,www.talosintelligence.com/reports/TALOS-2017-0338/; classtype:attempted-user; sid:42973; rev:3;)
# alert tcp $EXTERNAL_NET 3389 -> $HOME_NET any (msg:"PROTOCOL-OTHER FreeRDP PER length integer underflow attempt"; flow:to_client,established; content:"|03 00|"; depth:2; content:"|02 F0 80 68 00 01 03 EB 70|"; within:9; distance:2; byte_test:1,<,4,0,relative; metadata:policy max-detect-ips drop, policy security-ips drop, service rdp; reference:cve,2017-2834; reference:cve,2017-2835; reference:url,www.talosintelligence.com/reports/TALOS-2017-0336/; reference:url,www.talosintelligence.com/reports/TALOS-2017-0337/; classtype:attempted-user; sid:42941; rev:3;)
# alert tcp $EXTERNAL_NET 443 -> $HOME_NET any (msg:"PROTOCOL-OTHER ARM mbed TLS x509 invalid public key remote code execution attempt"; flow:to_client,established; content:"|04 08 30 06 01 01 FF 02 01 0A 30 22 06 03 55 1D 0E 04 1B 04 63 6F C0 C0 30 0A 06 08 2A 86 48 CE 3D 04 03 02 03|"; fast_pattern:only; metadata:policy max-detect-ips drop, policy security-ips drop, service ssl; reference:url,www.talosintelligence.com/reports/TALOS-2017-0274; classtype:attempted-user; sid:41364; rev:3;)
# alert udp $EXTERNAL_NET any -> $HOME_NET 1040 (msg:"PROTOCOL-OTHER TP-Link TDDP Get_config configuration leak attempt"; flow:to_server; content:"|01 02 00|"; depth:3; content:"|00 00|"; within:2; distance:7; metadata:policy max-detect-ips drop, policy security-ips drop, ruleset community; reference:url,www.coresecurity.com/advisories/tp-link-tddp-multiple-vulnerabilities; classtype:attempted-recon; sid:40907; rev:2;)
# alert udp $EXTERNAL_NET any -> $HOME_NET 1040 (msg:"PROTOCOL-OTHER TP-Link TDDP SET_CONFIG type buffer overflow attempt"; flow:to_server; dsize:>336; content:"|01 01 00|"; depth:3; byte_test:4,>=,0x0264,4,big; metadata:policy max-detect-ips drop, policy security-ips drop, ruleset community; reference:url,www.coresecurity.com/advisories/tp-link-tddp-multiple-vulnerabilities; classtype:attempted-user; sid:40866; rev:3;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"PROTOCOL-OTHER Websocket upgrade request without a client key detected"; flow:to_server,established; content:"Upgrade: ws"; fast_pattern:only; http_header; content:!"Sec-WebSocket-Key"; http_header; metadata:policy max-detect-ips drop, service http; reference:cve,2015-8027; classtype:misc-activity; sid:37028; rev:2;)
# alert tcp $HOME_NET 1900 -> $HOME_NET any (msg:"PROTOCOL-OTHER MiniUPNP rootdesc.xml buffer overflow attempt"; flow:to_client,established; flowbits:isset,file.rootdesc; file_data; content:"<?xml"; content:"<specVersion"; isdataat:100,relative; content:!">"; within:100; metadata:policy max-detect-ips drop, policy security-ips drop, service http; reference:cve,2015-6031; reference:url,www.talosintelligence.com/reports/TALOS-2015-0035; classtype:attempted-user; sid:35690; rev:5;)
# alert tcp $HOME_NET 1900 -> $HOME_NET any (msg:"PROTOCOL-OTHER MiniUPNP rootdesc.xml buffer overflow attempt"; flow:to_client,established; flowbits:isset,file.rootdesc; file_data; content:"<?xml"; content:"<"; isdataat:100,relative; content:!">"; within:100; pcre:"/<\s*[^\s]{100}/"; metadata:policy max-detect-ips drop, service http; reference:cve,2015-6031; reference:url,www.talosintelligence.com/reports/TALOS-2015-0035; classtype:attempted-user; sid:35689; rev:5;)
alert tcp $HOME_NET any -> $HOME_NET 1900 (msg:"PROTOCOL-OTHER MiniUPNP rootdesc.xml file request"; flow:to_server,established; content:"/rootDesc.xml HTTP/1."; fast_pattern:only; flowbits:set,file.rootdesc; flowbits:noalert; metadata:policy balanced-ips alert, policy max-detect-ips alert, policy security-ips alert, service http; reference:cve,2015-6031; reference:url,www.talosintelligence.com/reports/TALOS-2015-0035; classtype:misc-activity; sid:35688; rev:8;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET [389] (msg:"PROTOCOL-OTHER OpenLDAP Search Parsing serialNumberAndIssuerCheck integer overflow attempt"; flow:to_server,established; content:"|30|"; depth:1; content:"|63|"; within:1; distance:4; content:"|04|"; within:1; distance:1; byte_jump:1,0,relative,post_offset 15; content:"|A9|"; within:1; content:"|81|"; within:1; distance:1; byte_jump:1,0,relative; content:"|83|"; within:1; content:"{serialNumber"; within:100; content:!"}"; within:100; metadata:policy max-detect-ips drop, service ldap; reference:cve,2020-36221; reference:url,bugs.openldap.org/show_bug.cgi?id=9404; reference:url,bugs.openldap.org/show_bug.cgi?id=9424; classtype:denial-of-service; sid:58045; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET [389] (msg:"PROTOCOL-OTHER OpenLDAP Search Parsing serialNumberAndIssuerCheck integer overflow attempt"; flow:to_server,established; content:"|30 81|"; depth:2; content:"|63|"; within:1; distance:4; byte_jump:1,0,relative; content:"|A0|"; within:1; content:"{serialNumber"; within:100; content:!"}"; within:100; metadata:policy max-detect-ips drop, service ldap; reference:cve,2020-36221; reference:url,bugs.openldap.org/show_bug.cgi?id=9404; reference:url,bugs.openldap.org/show_bug.cgi?id=9424; classtype:denial-of-service; sid:58044; rev:1;)
# alert tcp $EXTERNAL_NET 1883 -> $HOME_NET any (msg:"PROTOCOL-OTHER libcurl mqtt use after free attempt"; flow:to_client,established; flowbits:isset,MQTT_Connect; content:"|00 00 E0 00|"; depth:4; isdataat:!0,relative; metadata:policy max-detect-ips drop; reference:cve,2021-22945; reference:url,hackerone.com/reports/1269242; classtype:attempted-user; sid:58846; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"PROTOCOL-OTHER Git LFS object request detected"; flow:to_server,established; content:"/objects/"; depth:9; nocase; http_uri; content:"User-Agent: git-lfs"; fast_pattern:only; http_header; flowbits:set,git_lfs; flowbits:noalert; metadata:policy max-detect-ips alert, service http; reference:cve,2021-21300; reference:url,packetstormsecurity.com/files/163978/Git-LFS-Clone-Command-Execution.html; classtype:protocol-command-decode; sid:59117; rev:1;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"PROTOCOL-OTHER Git LFS clone arbitrary code execution attempt"; flow:to_client,established; flowbits:isset,git_lfs; file_data; content:"#!/bin"; fast_pattern:only; metadata:policy max-detect-ips drop, service http; reference:cve,2021-21300; reference:url,packetstormsecurity.com/files/163978/Git-LFS-Clone-Command-Execution.html; classtype:attempted-user; sid:59116; rev:1;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"PROTOCOL-OTHER cURL libcurl NtLM type 3 stack based buffer overflow attempt"; flow:to_client,established; isdataat:1000,rawbytes; content:"Authenticate:"; http_header; content:"NtLM"; within:10; nocase; http_header; pcre:"/Authenticate:\s+([A-Za-z0-9\x2D\x2F]+\x2C\s+){0,3}NtLM\s+[A-Za-z0-9=+\/]{900}/Him"; metadata:policy max-detect-ips drop, policy security-ips drop, service http; reference:cve,2019-3822; classtype:attempted-user; sid:59528; rev:1;)
# alert tcp any any <> any 179 (msg:"PROTOCOL-OTHER BGP EVPN MAC/IP Advertisement address length overflow attempt"; flow:established; content:"|FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF|"; content:"|02|"; within:1; distance:2; content:"|0E|"; distance:0; content:"|00 19 46|"; within:3; distance:2; byte_jump:1,0,relative; content:"|00 02|"; within:2; byte_test:1,>,128,30,relative; metadata:policy max-detect-ips drop, service bgp; reference:cve,2017-12319; classtype:attempted-dos; sid:61199; rev:1;)
